const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".inRequests").hasClass("absolute")?$(".header, .draft").toggleClass("blur"):$(".wrapper, .header, .draft").toggleClass("blur"),$(".wrapper *").removeClass("translateXbackwards")};$(".confirmation__body__cancel").click(()=>{smartHide(".confirmation","out")});const handleHomeBtnClick=(e,t)=>{$(`.home__${t}__${e}`).click(()=>{var t;"newRequest"===e&&"inRequests"===(t="inRequests")&&$(`.${t}__step1`).removeClass("hidden").addClass("flex"),$(".home").addClass("hidden").removeClass("flex"),$(".returnIcon, .header__container__msg").removeClass("hidden")})};handleHomeBtnClick("newRequest","btnContainer");const socket=io();let inRequestsReaderGender,data2send={table:"",values:[]};const toggleSwitch=(e,t,a)=>{a?($(e).prop("checked",!0),$(t).removeClass("unchecked").addClass("checked")):($(e).prop("checked",!1),$(t).removeClass("checked").addClass("unchecked"))};let globalSettings={};socket.on("settings",e=>{globalSettings.sendcc=e.sendcc,globalSettings.sendmail=e.sendmail,globalSettings.mail_address=e.mail_address,globalSettings.sender=e.sender,globalSettings.smtp_user=e.smtp_user,globalSettings.smtp_host=e.smtp_host,globalSettings.smtp_passwd=e.smtp_passwd,globalSettings.wallpaper=e.wallpaper,e.sendcc?toggleSwitch(".toggleMailCc__Input",".toggleMailCc__Slider",!0):toggleSwitch(".toggleMailCc__Input",".toggleMailCc__Slider",!1),e.sendmail?toggleSwitch(".toggleMail__Input",".toggleMail__Slider",!0):toggleSwitch(".toggleMail__Input",".toggleMail__Slider",!1),$(".settings__child__senderContainer__senderLabel__input").val(globalSettings.sender),$(".settings__child__mailContainer__smtpHostLabel__input").val(globalSettings.smtp_host),$(".settings__child__mailContainer__smtpUserLabel__input").val(globalSettings.smtp_user),$(".settings__child__mailContainer__smtpHostLabel__input").val(globalSettings.smtp_host)});const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);let validationErr=!1;$(".returnIcon").click(()=>{const e=(e,t)=>{var a;e.match(/(step1|users|locations)/gi)?$(e).is(":visible")&&e.match(/inRequests__step1|users|locations/gi)&&(a=e,$(a).removeClass("translateXbackwards").toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__container__msg").addClass("hidden").removeClass("flex"),setTimeout(()=>{$(a).toggleClass("translateXonwards flex")},500)):$(e).is(":visible")&&($(e).addClass("translateXonwards hidden").removeClass("flex"),$(t).removeClass("translateXbackwards hidden").addClass("flex"))};e(".users"),e(".locations"),e(".inRequests__step1")}),$(".menu__item").click(()=>{$(".header__menu__switch").prop("checked")&&$(".header__menu__switch").prop("checked",!1)});const invalid=e=>{e.addClass("invalid"),validationErr=!0};socket.on("notification",e=>{"success"===e.type?($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationFailure").addClass("notificationSuccess"),$(".notification__msg").text("Changements enregistr√©s avec succ√®s ! üòâ")):"error"===e.type?($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationSuccess").addClass("notificationFailure"),$(".notification__msg").text("Une erreur s'est produite... üò±")):"info"===e.type?($(".notification__icon").attr("src","./src/scss/icons/info.svg"),$(".notification").removeClass("notificationSuccess notificationMail notificationFailure").addClass("notificationInfo"),$(".notification__msg").text("Aucune donn√©e correspondante n'a √©t√© trouv√©e... üò∂")):"mail"===e.type&&($(".notification__icon").attr("src","./src/scss/icons/mail.svg"),$(".notification").removeClass("notificationInfo notificationSuccess notificationFailure").addClass("notificationMail"),$(".notification__msg").text("Mail envoy√© üòé")),$(".notification").removeClass("hidden").addClass("flex"),setTimeout(()=>{$(".notification").fadeOut((function(){$(this).removeAttr("style").removeClass("notificationSuccess notificationFailure notificationInfo flex").addClass("hidden")}))},5e3)});const smartHide=(e,t,a)=>{"in"===t?($(e).toggleClass("hidden flex"),$(".wrapper, .header").addClass("blur")):($(e).toggleClass("hidden flex"),$(".inRequests").hasClass("absolute")?$(".header").toggleClass("blur"):$(".wrapper, .header").toggleClass("blur"),void 0!==a&&clearTimeout(a))},setDate=()=>{$(".inRequests__form__requestInfo__row1__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`)},setDay=e=>e.getDate()<10?"0"+e.getDate():e.getDate(),setMonth=e=>e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1;$(".inRequests__form__requestInfo__row1__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`);const exportDB=()=>{let e="";$(".export__child__container__format input.radio").each((function(){$(this).is(":checked")&&(e=$(this).val())})),socket.emit("export db",e),e=""};let initialPibNb,initialBarcode;$(".exportsLink").click(()=>{smartHide(".export","in"),format=""}),$(".export .btn--submit").click(()=>{exportDB()}),$(".export .btn--reset").click(()=>{smartHide(".export","out")}),socket.on("export successfull",()=>{smartHide(".export","out"),window.open("/download")});const inRequests=()=>{let e;console.log(globalSettings);let t=$(".inRequests__form__applicantInfo__name"),a=$(".inRequests__form__applicantInfo__firstname"),s=$(".inRequests__form__requestInfo__row1__requestDate"),n=$(".inRequests__form__requestInfo__comment"),_=$(".inRequests__form__requestInfo__row1__assignedWorker");$(".inRequests__form__btnContainer__submit").click(i=>{i.preventDefault();let o=$(".inRequests__form__applicantInfo__location option:selected");if(data2send.table="tasks",""===t.val()&&invalid(t),""===a.val()&&invalid(a),""===o.val()&&invalid(o),""===s.val()&&invalid(s),""===n.val()&&invalid(n),$(".inRequests").hasClass("absolute")&&""===_.val()&&invalid(_),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout(()=>{t.val(t.val().replace(/'/g,"''")),a.val(a.val().replace(/'/g,"''")),o.val(o.val().replace(/'/g,"''")),n.val(n.val().replace(/'/g,"''")),$(".inRequests").hasClass("absolute")&&_.val(_.val().replace(/'/g,"''")),data2send.values.push(t.val()),data2send.values.push(a.val()),data2send.values.push(new Date(s.val()).toUTCString()),data2send.values.push(o.val()),data2send.values.push(n.val()),data2send.mail={},$(".inRequests").hasClass("absolute")?(data2send.mail.id=data2send.id=$(".inRequests.absolute .inRequests__id").text(),data2send.mail.creationDate=new Date(s.val()).toLocaleDateString(),"done"===$(".inRequests__form__requestInfo__row1__status option:selected").val()?(data2send.mail.title=`üèÅ La demande n¬∞${data2send.mail.id} est trait√©e üèÅ`,data2send.mail.status="done"):(data2send.mail.title=`üôÉ La demande n¬∞${data2send.mail.id} a √©t√© mise √† jour üôÉ`,data2send.mail.status="wip"),data2send.values.push($(".inRequests__form__requestInfo__row1__status").val()),data2send.values.push(_.val()),$(".inRequests.absolute").toggleClass("hidden flex"),$(".wrapper").toggleClass("backgroundColor blur"),socket.emit("update",data2send),$(".inRequests.absolute .inRequests__form__btnContainer__hide").toggleClass("hidden")):(data2send.mail.title="üî• Une nouvelle demande a √©t√© introduite dans le tableau d'intervention üî•",data2send.mail.status="waiting",data2send.values.push("waiting"),socket.emit("append data",data2send),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")),globalSettings.sendmail&&socket.emit("send mail",{request:n.val(),applicant:{name:t.val(),firstname:a.val(),location:o.text()},sendcc:globalSettings.sendCc,mail:data2send.mail}),$(".inRequests__form .input").not(".inRequests__form__requestInfo__row1__requestDate").val(""),confirmation(),data2send.values=[]},5e3)}),$(".inRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e)})};let addLocationTimeout;inRequests(),$(".leaveLink").click(()=>{$(".wrapper, header").toggleClass("blur"),$(".leave").toggleClass("hidden flex"),$(".leave").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))})),$(".shutdownBtn").click(()=>{socket.emit("shutdown")}),$(".restartBtn").click(()=>{socket.emit("restart"),setTimeout(()=>{location.reload()},1e4)})});const manageLocations=()=>{$(".addLocation__form__btnContainer__submit").click(()=>{event.preventDefault(),data2send.table="locations";let e=$(".addLocation__form__name input"),t=$(".addLocation__form__email input");if(""===e.val()&&invalid(e),(t.is(":invalid")||""===t.val())&&invalid(t),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".addLocation__form")}validationErr=!1,data2send.values=[]}else{const a=()=>{data2send.values.push(capitalizeFirstLetter(e.val())),data2send.values.push(t.val()),$(".addLocation__title").text().match("Modification")?(data2send.id=$(".addLocation.absolute .addLocation__form__userID").val(),socket.emit("update",data2send)):socket.emit("append data",data2send),data2send.values=[],$(".addLocation").removeAttr("style").toggleClass("hidden flex"),$(".addLocation input").val(""),confirmation(),$(".locations").removeClass("blur backgroundColor"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")};$(".input").removeClass("invalid"),$("form .warning").addClass("hidden"),confirmation(),addLocationTimeout=setTimeout((function(){a()}),5e3)}}),$(".addLocation__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(addLocationTimeout)})};$(".addLocation__form__btnContainer__submit").click(()=>{event.preventDefault(),data2send.table="locations";let e=$(".addLocation__form__name input"),t=$(".addLocation__form__email input");if(""===e.val()&&invalid(e),(t.is(":invalid")||""===t.val())&&invalid(t),validationErr)$("form .warning").length||$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".addLocation__form"),validationErr=!1,data2send.values=[];else{const a=()=>{data2send.values.push(capitalizeFirstLetter(e.val())),data2send.values.push(t.val()),$(".addLocation__title").text().match("Modification")?(data2send.id=$(".addLocation.absolute .addLocation__form__userID").val(),socket.emit("update",data2send)):socket.emit("append data",data2send),data2send.values=[],$(".addLocation").removeAttr("style").toggleClass("hidden flex"),$(".addLocation input").val(""),confirmation(),$(".locations").removeClass("blur backgroundColor"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")};$(".input").removeClass("invalid"),$("form .warning").addClass("hidden"),confirmation(),addLocationTimeout=setTimeout((function(){a()}),5e3)}}),$(".addLocation__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(addLocationTimeout)});let parent,iDataRow=0;const appendUserRow=(e,t)=>{let a=$("<span></span>").addClass(`users__container__row users__container__row--${e} flex`).appendTo(".users__container");$("<span></span>").addClass("users__container__row__item users__container__row__item--id hidden").append(t.user_id).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--name").append(t.name.replace(/\'\'/g,"'")).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--firstname").append(t.firstname.replace(/\'\'/g,"'")).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--email").append(t.email).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--location").append(t.location_name).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--location_id hidden").append(t.location_id).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--gender hidden").append(t.gender).appendTo(a),$("<input>").attr("type","password").addClass("users__container__row__item users__container__row__item--pwd input noInput").val("12345678").appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--type").append(t.type).appendTo(a)},appendLocationRow=(e,t)=>{let a=$("<span></span>").addClass(`locations__container__row locations__container__row--${e} flex`).appendTo(".locations__container");$("<span></span>").addClass("locations__container__row__item locations__container__row__item--id hidden").append(t.location_id).appendTo(a),$("<span></span>").addClass("locations__container__row__item locations__container__row__item--name").append(t.location_name.replace(/\'\'/g,"'")).appendTo(a),$("<span></span>").addClass("locations__container__row__item locations__container__row__item--email").append(t.location_mail).appendTo(a)},toggleHeader=()=>$(".header__container").toggleClass("hidden flex"),hideMenu=e=>{$("."+e).hasClass("hidden")||$("."+e).removeClass("flex").addClass("hidden")},showMenu=e=>{$("."+e).hasClass("hidden")&&$("."+e).removeClass("hidden").addClass("flex")},manageUsers=()=>{const e=(e,t)=>{$(`.${e}.absolute .${e}__form__btnContainer__hide`).ready((function(){$(`.${e}.absolute .${e}__form__btnContainer__hide`).click((function(){$("."+e).removeClass("absolute zero flex").addClass("hidden"),$("."+t).removeClass("blur backgroundColor"),$(this).addClass("hidden")}))}))},t=(e,t)=>{$(`.${t}__header__addBtn`).click((function(){toggleHeader(),$("."+t).addClass("blur backgroundColor"),$(`.${e} input`).not(".radio").val(""),$(".register select").val("default"),"users"===e?$(".register__title").text("Ajouter un utilisateur"):$(".addLocation__title").text("Ajouter une implantation"),$("."+e).addClass("absolute zero flex").removeClass("hidden")})),$(`.${e}.absolute .${e}__form__btnContainer__submit`).click((function(){toggleHeader(),$("."+e).removeClass("absolute zero flex").addClass("hidden"),$("."+t).removeClass("blur backgroundColor")}))},a=(e,t,a)=>{if($(`.${a}__container`).empty((function(){$(this).fadeOut()})),void 0!==e[0]){let s=$("<span></span>").addClass(a+"__container__header flex").appendTo(`.${a}__container`);for(const[t,n]of Object.keys(e[0]).entries()){let e=n;if("users"===a)switch(n){case"name":e="Nom";break;case"firstname":e="Pr√©nom";break;case"email":e="Adresse email";break;case"location":e="Implantation";break;case"password":e="Mot de passe";break;case"type":e="Type de compte";break;default:e=""}else switch(n){case"location_name":e="Nom";break;case"location_mail":e="Adresse email";break;default:e=""}if(""!==e){$("<span></span>").addClass(a+"__container__header__item").text(e).appendTo(s)}}for(const[t,s]of e.entries())"users"===a?appendUserRow(t,s):appendLocationRow(t,s),t===e.length-1&&(iDataRow=t+1);$(`.${a}__container`).fadeIn(),$(".context").length&&($(`.${a}__container__row`).contextmenu((function(e){$(".context").css({left:e.pageX+"px",top:e.pageY+"px"}).toggleClass("hidden flex"),parent=$(this).attr("class").split(" ")[1],e.preventDefault(),$(`.${a}, .${a} *`).click((function(e){e.target===this&&$(".context").removeClass("flex").addClass("hidden")}))})),$(".context__list__item--modify").click((function(){let e;$(".users").hasClass("flex")?($(".register").addClass("absolute zero flex").removeClass("hidden"),$(".register.absolute .register__form__password input").attr("placeholder","Laisser vide pour un mot de passe inchang√©"),$(".users").addClass("blur backgroundColor")):$(".locations").hasClass("flex")&&($(".addLocation").addClass("absolute zero flex").removeClass("hidden"),$(".locations").addClass("blur backgroundColor")),toggleHeader(),e="users"===a?"Modification de l'utilisateur":"Modification de l'implantation",$(`.${t}__title`).text(`${e} ${$(`.${parent} .${a}__container__row__item--firstname`).text()}\n            ${$(`.${parent} .${a}__container__row__item--name`).text()}`),$(`.${t}.absolute .${t}__form__userID`).val($(`.${parent} .${a}__container__row__item--id`).text()),$(`.${t}.absolute .${t}__form__name input`).val($(`.${parent} .${a}__container__row__item--name`).text()),$(`.${t}.absolute .${t}__form__email input`).val($(`.${parent} .${a}__container__row__item--email`).text()),"users"===a&&($(`.${t}.absolute .${t}__form__userFirstName input`).val($(`.${parent} .${a}__container__row__item--firstname`).text()),$(`.${t}.absolute .${t}__form__location select`).val($(`.${parent} .${a}__container__row__item--location_id`).text()),$(`.${t}.absolute .${t}__form__type select`).val($(`.${parent} .${a}__container__row__item--type`).text()),"m"===$(`.${parent} .${a}__container__row__item--gender`).text()?$(`.${t}.absolute .${t}__form__male input`).attr("checked",!0):$(`.${t}.absolute .${t}__form__female input`).attr("checked",!0)),$(`.${t}.absolute .${t}__form__btnContainer__submit`).click(()=>{$(`.${parent} .${a}__container__row__item--name`).text($(`.${t}__form__name input`).val().replace(/\'\'/g,"'")),$(`.${parent} .${a}__container__row__item--email`).text($(`.${t}__form__email input`).val()),"users"===a&&($(".register.absolute .register__form__password input").attr("placeholder","Ins√©rez le mot magique"),$(`.${parent} .${a}__container__row__item--firstname`).text($(`.${t}__form__userFirstName input`).val().replace(/\'\'/g,"'")),$(`.${parent} .${a}__container__row__item--location`).text($(`.${t}__form__location option:selected`).text().replace(/\'\'/g,"'")),$(`.${parent} .${a}__container__row__item--type`).text($(`.${t}__form__type option:selected`).val()))})})),$(".context__list__item--del").click((function(){let e={};parent.match("users")?(e.key=$(`.${parent} .users__container__row__item--id`).text(),e.table="users"):parent.match("locations")&&(e.key=$(`.${parent} .locations__container__row__item--id`).text(),e.table="locations"),confirmation(),recordDelTimeOut=setTimeout(()=>{$("."+parent).removeClass("flex").addClass("hidden"),confirmation(),socket.emit("delete data",e),e={}},5e3)})))}},s=(e,t)=>{$(`.${e}Link`).click(()=>{hideMenu("inRequests"),hideMenu(t),showMenu(e),socket.emit("get "+e)})};s("users","locations"),s("locations","users"),$(".locationsLink, .usersLink").click((function(){($(".locations").hasClass("hidden")||$(".users").hasClass("hidden"))&&$(".home").removeClass("flex").addClass("hidden"),showMenu("returnIcon"),showMenu("header__container__msg")})),socket.on("users retrieved",e=>{a(e,"register","users")}),socket.on("locations retrieved",e=>{a(e,"addLocation","locations")}),$(".context__list__item").click(()=>{$(".context").removeClass("flex").addClass("hidden")}),$(".context__list__item--modify, .locations__header__addBtn, .users__header__addBtn").click(()=>{e("register","users"),e("addLocation","locations")}),$(".confirmation__body__cancel").click(()=>{clearTimeout(recordDelTimeOut),$("."+parent).removeClass("hidden").addClass("flex"),recordDelTimeOut=void 0,record2delete={}}),t("register","users"),t("addLocation","locations")};manageUsers();const register=()=>{let e,t=$(".register__form__name input"),a=$(".register__form__userFirstName input"),s=$(".register__form__password input"),n=$(".register__form__email input");$(".register__form__btnContainer__submit").click(_=>{_.preventDefault(),data2send.table="users";let i="",o=$(".register__form__location option:selected").val(),r=$(".register__form__type option:selected").val();if($(".register__form__gender input.radio").each((function(){$(this).is(":checked")&&(i=$(this).val())})),""===t.val()&&invalid(t),""===a.val()&&invalid(a),"default"===o&&invalid($(".register__form__location .input")),$(".register").hasClass("absolute")&&$(".register__title").text().match("Modification")||""===s.val()&&invalid(s),(n.is(":invalid")||""===n.val())&&invalid(n),"default"===r&&invalid($(".register__form__type .input")),""===i&&invalid($(".register__form__gender input.radio")),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".register__form")}validationErr=!1,data2send.values=[]}else{const _=()=>{data2send.setPassword=!0,data2send.values.push(capitalizeFirstLetter(t.val())),data2send.values.push(capitalizeFirstLetter(a.val())),data2send.values.push(n.val()),data2send.values.push(o),data2send.values.push(i),data2send.values.push(r),$(".register").hasClass("absolute")&&$(".register__title").text().match("Modification")?(data2send.id=$(".register.absolute .register__form__userID").val(),""!==s.val()?(data2send.setPassword=!0,data2send.values.push(s.val())):data2send.setPassword=!1,socket.emit("update",data2send),s.attr("placeholder","Ins√©rez le mot magique")):(data2send.values.push(s.val()),socket.emit("append data",data2send)),data2send.values=[],$(".register").removeAttr("style").toggleClass("hidden flex"),$(".register input").not(".radio").val(""),"/"===window.location.pathname&&(confirmation(),$(".users").removeClass("blur backgroundColor"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"))};$(".input").removeClass("invalid"),$("form .warning").addClass("hidden"),"/"===window.location.pathname?(confirmation(),e=setTimeout((function(){_()}),5e3)):_()}}),$(".register__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e)})};socket.on("first user added",()=>{window.location.reload()}),register();const search=()=>{let e,t={table:"",applicant_name:"",getApplicant:!1};$(".search__container").submit(e=>{e.preventDefault(),t.getApplicant=!1,"default"!==$(".search__container__select").val()&&(t.location=$(".search__container__select").val(),""!==$(".search__container__readerInput").val()&&(t.applicant_name=$(".search__container__readerInput").val().replace(/\'/g,"''"),t.getApplicant=!0),socket.emit("search",t),t.location=t.applicant_name="",t.getApplicant=!1)}),socket.on("search results",t=>{let a;if($(".search__results__container").empty((function(){$(this).fadeOut()})),void 0!==t[0]){let s=$("<span></span>").addClass("search__results__container__header flex").appendTo(".search__results__container");for(const[e,a]of Object.keys(t[0]).entries()){let e=a;switch(a){case"task_id":e="N¬∞ de demande";break;case"applicant_name":e="Nom du demandeur";break;case"applicant_firstname":e="Pr√©nom du demandeur";break;case"request_date":e="Date";break;case"comment":e="Contenu de la demande";break;case"status":e="Statut";break;case"user_fk":e="Attribution";break;default:e=""}if(""!==e){$("<span></span>").addClass("search__results__container__header__item").text(e).appendTo(s)}}for(const[e,a]of t.entries()){let t=$("<span></span>").addClass(`search__results__container__row search__results__container__row--${e} flex`).appendTo(".search__results__container"),s=($("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--id").append(a.task_id).appendTo(t),$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--name").append(a.applicant_name.replace(/\'\'/g,"'")).appendTo(t),$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--firstname").append(a.applicant_firstname.replace(/\'\'/g,"'")).appendTo(t),$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--date")),n=$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--timestamp hidden");null!==a.request_date?(s.append(new Date(a.request_date).toLocaleDateString()),n.append(a.request_date.split("T")[0])):s.append("Probl√®me d'affichage..."),n.appendTo(t),s.appendTo(t);let _=$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--aw").appendTo(t),i={"''":"'","\n":"<br>"};$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--body").append(a.comment.replace(/\n|\'\'/g,e=>i[e])).appendTo(t);if(void 0!==a.user_fk&&null!==a.user_fk){_.append(`${a.name.toUpperCase()}, ${a.firstname}`);$("<span></span>").addClass("search__results__container__row__item--awid hidden").append(a.user_fk).appendTo(t)}else null===a.user_fk?_.append("Non attribu√©"):(_.append("Probl√®me d'affichage :(("),console.trace(`Assigned worker for task n¬∞${a.task_id} : ${a.name.toUpperCase()}, ${a.firstname}`));let o=$('      <svg xmlns="http://www.w3.org/2000/svg">        <circle cx="50%" cy="50%" r="5"/>        <title class="status__title"></title>      </svg>      ').addClass("search__results__container__row__item search__results__container__row__item--status").attr("viewBox","0 0 75 10").appendTo(t);"waiting"===a.status?(o.removeClass("done wip").addClass("waiting"),$(`.${o.attr("class").split(" ").join(".")} .status__title`).text("En attente d'attribution")):"done"===a.status?(o.removeClass("waiting wip").addClass("done"),$(`.${o.attr("class").split(" ").join(".")} .status__title`).text("Termin√©e")):(o.removeClass("done waiting").addClass("wip"),$(`.${o.attr("class").split(" ").join(".")} .status__title`).text("En cours de traitement"))}$(".search__results__container").fadeIn(),$(".context").length&&($(".search__results__container__row").contextmenu((function(e){$(".context").css({left:e.pageX+"px",top:e.pageY+"px"}).toggleClass("hidden flex"),a=$(this).attr("class").split(" ")[1],e.preventDefault(),$(".search__results, .search__results *").click((function(e){e.target===this&&$(".context").removeClass("flex").addClass("hidden")}))})),$(".context__list__item").click(()=>{$(".context").removeClass("flex").addClass("hidden")}),$(".context__list__item--modify").click((function(){let e=$(`.${a} .search__results__container__row__item--timestamp`).text();$(".wrapper").addClass("blur"),$(".inRequests").addClass("absolute flex").removeClass("hidden"),$(".inRequests.absolute .inRequests__form__btnContainer__hide, .inRequests__form__requestInfo__row1__assignedWorker, .inRequests.absolute .inRequests__form__requestInfo__row1__status").removeClass("hidden").addClass("flex"),$(".inRequests__form__applicantInfo__location, .inRequests__form__requestInfo__row1 label").addClass("hidden").removeClass("flex"),$(".inRequests.absolute .inRequests__id").text($(`.${a} .search__results__container__row__item--id`).text()),$(".inRequests.absolute .inRequests__form__applicantInfo__location").val($(".search__container__select").val()),$(".inRequests.absolute .inRequests__form__applicantInfo__name").val($(`.${a} .search__results__container__row__item--name`).text()),$(".inRequests.absolute .inRequests__form__applicantInfo__firstname").val($(`.${a} .search__results__container__row__item--firstname`).text()),$(".inRequests.absolute .inRequests__form__requestInfo__row1__requestDate").val(e),$(".inRequests.absolute .inRequests__form__requestInfo__comment").val($(`.${a} .search__results__container__row__item--body`).text().replace("<br>","\n")),$(".inRequests.absolute .inRequests__form__requestInfo__row1__assignedWorker").val($(`.${a} .search__results__container__row__item--awid`).text()),$(`.${a} .search__results__container__row__item--status`).hasClass("wip")?$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("wip"):$(`.${a} .search__results__container__row__item--status`).hasClass("waiting")?$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("waiting"):$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("done"),$(".inRequests.absolute .inRequests__form__btnContainer__submit").click(()=>{$(`.${a} .search__results__container__row__item--name`).text($(".inRequests__form__applicantInfo__name").val().replace(/\'\'/g,"'")),$(`.${a} .search__results__container__row__item--firstname`).text($(".inRequests__form__applicantInfo__firstname").val().replace(/\'\'/g,"'")),$(`.${a} .search__results__container__row__item--date`).text(new Date($(".inRequests__form__requestInfo__row1__requestDate").val()).toLocaleDateString()),$(`.${a} .search__results__container__row__item--location`).text($(".inRequests__form__applicantInfo__location option:selected").text().replace(/\'\'/g,"'")),$(`.${a} .search__results__container__row__item--body`).text($(".inRequests__form__requestInfo__comment").val().replace("\n","<br>")),$(`.${a} .search__results__container__row__item--aw`).text($(".inRequests__form__requestInfo__row1__assignedWorker option:selected").text().replace(/\'\'/g,"'")),$(`.${a} .search__results__container__row__item--status`).removeClass("waiting wip done").addClass($(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val())}),$(".inRequests.absolute .inRequests__form__btnContainer__hide").click((function(){$(".inRequests").removeClass("absolute flex").addClass("hidden"),$(".wrapper").removeClass("blur backgroundColor"),$(this).addClass("hidden")}))})),$(".context__list__item--del").click((function(){let t={key:$(`.${a} .search__results__container__row__item--id`).text(),table:"tasks"};confirmation(),$("."+a).toggleClass("hidden flex"),e=setTimeout(()=>{$("."+a).remove(),confirmation(),socket.emit("delete data",t),t={}},5e3),$(".confirmation__body__cancel").click(()=>{clearTimeout(e),$("."+a).removeClass("hidden").addClass("flex"),e=void 0,t={}})})))}})};search();const settings=()=>{$(".settingsLink").click(()=>{$(".settings__container").toggleClass("hidden flex"),$(".wrapper").addClass("blur")}),$(".settings__container").click((function(e){if(e.target===this){let e={};$(this).toggleClass("hidden flex"),$(".wrapper").removeClass("blur"),globalSettings.sendmail!==$(".toggleMail__Input").prop("checked")&&(e.sendmail=globalSettings.sendmail=$(".toggleMail__Input").prop("checked")),globalSettings.sendcc!==$(".toggleMailCc__Input").prop("checked")&&(e.sendcc=globalSettings.sendcc=$(".toggleMailCc__Input").prop("checked")),globalSettings.sender!==$(".settings__child__senderContainer__senderLabel__input").val()&&(e.sender=globalSettings.sender=$(".settings__child__senderContainer__senderLabel__input").val()),globalSettings.smtp_host!==$(".settings__child__mailContainer__smtpHostLabel__input").val()&&(e.smtp_host=globalSettings.smtp_host=$(".settings__child__mailContainer__smtpHostLabel__input").val()),globalSettings.smtp_user!==$(".settings__child__mailContainer__smtpUserLabel__input").val()&&(e.smtp_user=globalSettings.smtp_user=$(".settings__child__mailContainer__smtpUserLabel__input").val()),""!==$(".settings__child__mailContainer__smtpPasswdLabel__input").val()&&(e.smtp_passwd=$(".settings__child__mailContainer__smtpPasswdLabel__input").val()),Object.keys(e).length>0&&socket.emit("settings",e)}}))};settings();const showAbout=()=>{$(".aboutLink").click(()=>{$(".wrapper, header").toggleClass("blur"),$(".about__container").toggleClass("hidden flex")}),$(".updateBtn").click(()=>{socket.emit("update check")}),socket.on("update progress",e=>{$(".updateBtn").text(e)}),$(".about__container").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))}))};showAbout();