const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".inRequests").hasClass("absolute")?$(".header, .draft").toggleClass("blur"):$(".wrapper, .header, .draft").toggleClass("blur"),$(".wrapper *").removeClass("translateXbackwards")};$(".confirmation__body__cancel").click(()=>{smartHide(".confirmation","out")});let mousePosition={};const getMousePosition=()=>{$(window).mousemove(e=>{mousePosition.y=e.pageY}),mousePosition.y>$(window).height()/100*80&&(mousePosition.y=mousePosition.y-($(".context.flex").height()+20))},handleHomeBtnClick=(e,t)=>{$(`.home__${t}__${e}`).click(()=>{var t;"newRequest"===e&&"inRequests"===(t="inRequests")&&$(`.${t}__step1`).removeClass("hidden").addClass("flex"),$(".home").addClass("hidden").removeClass("flex"),$(".returnIcon, .header__container__msg").removeClass("hidden")})};handleHomeBtnClick("newRequest","btnContainer");const socket=io();let inRequestsReaderGender,data2send={table:"",values:[]};const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);let validationErr=!1;$(".returnIcon").click(()=>{const e=(e,t)=>{var s;e.match(/(step1|register)/gi)?$(e).is(":visible")&&e.match(/inRequests__step1|register/gi)&&(s=e,$(s).removeClass("translateXbackwards").toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__container__msg").addClass("hidden").removeClass("flex"),setTimeout(()=>{$(s).toggleClass("translateXonwards flex")},500)):$(e).is(":visible")&&($(e).addClass("translateXonwards hidden").removeClass("flex"),$(t).removeClass("translateXbackwards hidden").addClass("flex"))};e(".inReturns__step1"),e(".register"),e(".inRequests__step1")}),$(".menu__item").click(()=>{$(".header__menu__switch").prop("checked")&&$(".header__menu__switch").prop("checked",!1)});const invalid=e=>{e.addClass("invalid"),validationErr=!0};socket.on("notification",e=>{"success"===e.type?($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationFailure").addClass("notificationSuccess"),$(".notification__msg").text("Changements enregistrÃ©s avec succÃ¨s ! ðŸ˜‰")):"error"===e.type?($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationSuccess").addClass("notificationFailure"),$(".notification__msg").text("Une erreur s'est produite... ðŸ˜±")):"info"===e.type?($(".notification__icon").attr("src","./src/scss/icons/info.svg"),$(".notification").removeClass("notificationSuccess notificationMail notificationFailure").addClass("notificationInfo"),$(".notification__msg").text("Aucune donnÃ©e correspondante n'a Ã©tÃ© trouvÃ©e... ðŸ˜¶")):"mail"===e.type?($(".notification__icon").attr("src","./src/scss/icons/mail.svg"),$(".notification").removeClass("notificationInfo notificationSuccess notificationFailure").addClass("notificationMail"),$(".notification__msg").text("Mail envoyÃ© au lecteur ðŸ˜Ž")):"barcode"===e.type&&($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").removeClass("notificationInfo notificationSuccess notificationFailure").addClass("notificationFailure"),$(".notification__msg").text("Plus aucun code-barres n'est disponible... ðŸ˜¶"),$(".inRequests__barcode__svg").remove(),$(".inRequests__form__docInfo__inv").val("")),$(".notification").removeClass("hidden").addClass("flex"),setTimeout(()=>{$(".notification").fadeOut((function(){$(this).removeAttr("style").removeClass("notificationSuccess notificationFailure notificationInfo flex").addClass("hidden")}))},5e3)});const smartHide=(e,t,s)=>{"in"===t?($(e).toggleClass("hidden flex"),$(".wrapper, .header").addClass("blur")):($(e).toggleClass("hidden flex"),$(".inRequests").hasClass("absolute")?$(".header").toggleClass("blur"):$(".wrapper, .header").toggleClass("blur"),void 0!==s&&clearTimeout(s))},setDate=()=>{$(".inRequests__form__requestInfo__row1__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`)},setDay=e=>e.getDate()<10?"0"+e.getDate():e.getDate(),setMonth=e=>e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1;$(".inRequests__form__requestInfo__row1__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`);const exportDB=()=>{let e="";$(".export__child__container__format input.radio").each((function(){$(this).is(":checked")&&(e=$(this).val())})),socket.emit("export db",e),e=""};let initialPibNb,initialBarcode;$(".exportsLink").click(()=>{smartHide(".export","in"),format=""}),$(".export .btn--submit").click(()=>{exportDB()}),$(".export .btn--reset").click(()=>{smartHide(".export","out")}),socket.on("export successfull",()=>{smartHide(".export","out"),window.open("/download")});const inRequests=()=>{let e,t=$(".inRequests__form__applicantInfo__name"),s=$(".inRequests__form__applicantInfo__firstname"),a=$(".inRequests__form__requestInfo__row1__requestDate"),n=$(".inRequests__form__requestInfo__comment"),i=$(".inRequests__form__requestInfo__row1__assignedWorker");$(".inRequests__form__btnContainer__submit").click(_=>{_.preventDefault();let o=$(".inRequests__form__applicantInfo__location option:selected");if(data2send.table="tasks",""===t.val()&&invalid(t),""===s.val()&&invalid(s),""===o.val()&&invalid(o),""===a.val()&&invalid(a),""===n.val()&&invalid(n),$(".inRequests").hasClass("absolute")&&""===i.val()&&invalid(i),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout(()=>{t.val(t.val().replace(/'/g,"''")),s.val(s.val().replace(/'/g,"''")),o.val(o.val().replace(/'/g,"''")),n.val(n.val().replace(/'/g,"''")),$(".inRequests").hasClass("absolute")&&i.val(i.val().replace(/'/g,"''")),data2send.values.push(t.val()),data2send.values.push(s.val()),data2send.values.push(new Date(a.val()).toUTCString()),data2send.values.push(o.val()),data2send.values.push(n.val()),$(".inRequests").hasClass("absolute")?(data2send.values.push($(".inRequests__form__requestInfo__row1__status").val()),data2send.values.push(i.val())):(data2send.sendMail=$(".inRequests__form__requestInfo__row1__sendMail").is(":checked"),data2send.values.push("waiting")),$(".inRequests").hasClass("absolute")?(data2send.id=$(".inRequests.absolute .inRequests__id").text(),$(".inRequests.absolute").toggleClass("hidden flex"),$(".wrapper").toggleClass("backgroundColor blur"),socket.emit("update",data2send),$(".inRequests.absolute .inRequests__form__btnContainer__hide").toggleClass("hidden")):(socket.emit("append data",data2send),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"),data2send.sendMail&&socket.emit("send mail",{request:n.val(),applicant:{name:t.val(),firstname:s.val(),location:o.text()}})),$(".inRequests__form .input").not(".inRequests__form__requestInfo__row1__requestDate").val(""),confirmation(),data2send.values=[]},5e3)}),$(".inRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e)})};inRequests(),$(".leaveLink").click(()=>{$(".wrapper, header").toggleClass("blur"),$(".leave").toggleClass("hidden flex"),$(".leave").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))})),$(".shutdownBtn").click(()=>{socket.emit("shutdown")}),$(".restartBtn").click(()=>{socket.emit("restart"),setTimeout(()=>{location.reload()},1e4)})});const register=()=>{let e,t=$(".register__form__username input"),s=$(".register__form__userFirstName input"),a=$(".register__form__password input"),n=$(".register__form__email input");$(".register__form__btnContainer__submit").click(i=>{i.preventDefault(),data2send.table="users";let _="",o=$(".register__form__location option:selected").val(),r=$(".register__form__type option:selected").val();if($(".register__form__gender input.radio").each((function(){$(this).is(":checked")&&(_=$(this).val())})),""===t.val()&&invalid(t),""===s.val()&&invalid(s),"default"===o&&invalid($(".register__form__location .input")),""===a.val()&&invalid(a),(n.is(":invalid")||""===n.val())&&invalid(n),"default"===r&&invalid($(".register__form__type .input")),""===_&&invalid($(".register__form__gender input.radio")),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".register__form")}validationErr=!1,data2send.values=[]}else{const i=()=>{data2send.values.push(capitalizeFirstLetter(t.val())),data2send.values.push(capitalizeFirstLetter(s.val())),data2send.values.push(n.val()),data2send.values.push(o),data2send.values.push(_),data2send.values.push(r),data2send.values.push(a.val()),socket.emit("append data",data2send),data2send.values=[],$(".register").removeAttr("style").toggleClass("hidden flex"),$(".register input").not(".radio").val(""),"/"===window.location.pathname&&(confirmation(),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"))};$(".input").removeClass("invalid"),$("form .warning").addClass("hidden"),"/"===window.location.pathname?(confirmation(),e=setTimeout((function(){i()}),5e3)):i()}}),$(".register__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e)})};$(".registerLink").click(()=>{$(".home, .returnIcon, .header__container__msg, .register").toggleClass("hidden flex")}),socket.on("user added",()=>{window.location.reload()}),register();const search=()=>{let e,t={table:"",applicant_name:"",getApplicant:!1};$(".search__container").submit(e=>{e.preventDefault(),t.getApplicant=!1,"default"!==$(".search__container__select").val()&&(t.location=$(".search__container__select").val(),""!==$(".search__container__readerInput").val()&&(t.applicant_name=$(".search__container__readerInput").val().replace(/\'/g,"''")),socket.emit("search",t),t.location=t.applicant_name="",t.getApplicant=!1)}),socket.on("search results",t=>{let s;if($(".search__results__container").empty((function(){$(this).fadeOut()})),void 0!==t[0]){let a=$("<span></span>").addClass("search__results__container__header flex").appendTo(".search__results__container");for(const[e,s]of Object.keys(t[0]).entries()){let e=s;switch(s){case"task_id":e="NÂ° de demande";break;case"applicant_name":e="Nom du demandeur";break;case"applicant_firstname":e="PrÃ©nom du demandeur";break;case"request_date":e="Date";break;case"comment":e="Contenu de la demande";break;case"status":e="Statut";break;case"user_fk":e="Attribution";break;default:e=""}if(""!==e){$("<span></span>").addClass("search__results__container__header__item").text(e).appendTo(a)}}for(const[e,s]of t.entries()){let t=$("<span></span>").addClass(`search__results__container__row search__results__container__row--${e} flex`).appendTo(".search__results__container"),a=($("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--id").append(s.task_id).appendTo(t),$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--name").append(s.applicant_name.replace(/\'\'/g,"'")).appendTo(t),$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--firstname").append(s.applicant_firstname.replace(/\'\'/g,"'")).appendTo(t),$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--date")),n=$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--timestamp hidden");null!==s.request_date?(a.append(new Date(s.request_date).toLocaleDateString()),n.append(s.request_date.split("T")[0])):a.append("ProblÃ¨me d'affichage..."),n.appendTo(t),a.appendTo(t);let i=$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--aw").appendTo(t);$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--body").append(s.comment.replace(/\n/gi,"<br>")).appendTo(t);if(void 0!==s.user_fk&&null!==s.user_fk){i.append(`${s.name.toUpperCase()}, ${s.firstname}`);$("<span></span>").addClass("search__results__container__row__item--awid hidden").append(s.user_fk).appendTo(t)}else null===s.user_fk?i.append("Non attribuÃ©"):(i.append("ProblÃ¨me d'affichage :(("),console.log(`Assigned worker for task nÂ°${s.task_id} : ${s.name.toUpperCase()}, ${s.firstname}`));let _=$('      <svg xmlns="http://www.w3.org/2000/svg">        <circle cx="50%" cy="50%" r="5"/>      </svg>      ').addClass("search__results__container__row__item search__results__container__row__item--status").attr("viewBox","0 0 75 10").appendTo(t);"waiting"===s.status?_.removeClass("done wip").addClass("waiting"):"done"===s.status?_.removeClass("waiting wip").addClass("done"):_.removeClass("done waiting").addClass("wip")}$(".search__results__container").fadeIn(),$(".search__results__container__row").contextmenu((function(e){const t=t=>{$(".context").css({left:e.pageX+"px",top:t+"px"}).toggleClass("hidden flex")};$(window).mousemove(e=>{mousePosition.y=e.pageY}),mousePosition.y>$(window).height()/100*80&&(mousePosition.y=mousePosition.y-($(".context.flex").height()+20)),s=$(this).attr("class").split(" ")[1],e.preventDefault(),"out_requests"!==$(".search__container__select").val()?t(mousePosition.y):t(e.pageY),$(".search__results, .search__results *").click((function(e){e.target===this&&$(".context").removeClass("flex").addClass("hidden")}))})),$(".context__list__item").click(()=>{$(".context").removeClass("flex").addClass("hidden")}),$(".context__list__item--modify").click((function(){let e=$(`.${s} .search__results__container__row__item--timestamp`).text();$(".wrapper").addClass("blur"),$(".inRequests").addClass("absolute flex").removeClass("hidden"),$(".inRequests.absolute .inRequests__form__btnContainer__hide, .inRequests__form__requestInfo__row1__assignedWorker, .inRequests.absolute .inRequests__form__requestInfo__row1__status").removeClass("hidden").addClass("flex"),$(".inRequests__form__applicantInfo__location, .inRequests__form__requestInfo__row1 label").addClass("hidden").removeClass("flex"),$(".inRequests.absolute .inRequests__id").text($(`.${s} .search__results__container__row__item--id`).text()),$(".inRequests.absolute .inRequests__form__applicantInfo__location").val($(".search__container__select").val()),$(".inRequests.absolute .inRequests__form__applicantInfo__name").val($(`.${s} .search__results__container__row__item--name`).text()),$(".inRequests.absolute .inRequests__form__applicantInfo__firstname").val($(`.${s} .search__results__container__row__item--firstname`).text()),$(".inRequests.absolute .inRequests__form__requestInfo__row1__requestDate").val(e),$(".inRequests.absolute .inRequests__form__requestInfo__comment").val($(`.${s} .search__results__container__row__item--body`).text().replace("<br>","\n")),$(".inRequests.absolute .inRequests__form__requestInfo__row1__assignedWorker").val($(`.${s} .search__results__container__row__item--awid`).text()),$(`.${s} .search__results__container__row__item--status`).hasClass("wip")?$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("wip"):$(`.${s} .search__results__container__row__item--status`).hasClass("waiting")?$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("waiting"):$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("done"),$(".inRequests.absolute .inRequests__form__btnContainer__submit").click(()=>{$(`.${s} .search__results__container__row__item--name`).text($(".inRequests__form__applicantInfo__name").val().replace(/\'\'/g,"'")),$(`.${s} .search__results__container__row__item--firstname`).text($(".inRequests__form__applicantInfo__firstname").val().replace(/\'\'/g,"'")),$(`.${s} .search__results__container__row__item--date`).text(new Date($(".inRequests__form__requestInfo__row1__requestDate").val()).toLocaleDateString()),$(`.${s} .search__results__container__row__item--location`).text($(".inRequests__form__applicantInfo__location option:selected").text().replace(/\'\'/g,"'")),$(`.${s} .search__results__container__row__item--body`).text($(".inRequests__form__requestInfo__comment").val().replace("\n","<br>")),$(`.${s} .search__results__container__row__item--aw`).text($(".inRequests__form__requestInfo__row1__assignedWorker option:selected").text().replace(/\'\'/g,"'")),$(`.${s} .search__results__container__row__item--status`).removeClass("waiting wip done").addClass($(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val())}),$(".inRequests.absolute .inRequests__form__btnContainer__hide").click((function(){$(".inRequests").removeClass("absolute flex").addClass("hidden"),$(".wrapper").removeClass("blur backgroundColor"),$(this).addClass("hidden")}))})),$(".context__list__item--del").click((function(){let t={key:$(`.${s} .search__results__container__row__item--id`).text(),table:$(".search__container__select").val()};confirmation(),$("."+s).toggleClass("hidden flex"),e=setTimeout(()=>{$("."+s).remove(),confirmation(),socket.emit("delete data",t),t={}},5e3),$(".confirmation__body__cancel").click(()=>{clearTimeout(e),$("."+s).removeClass("hidden").addClass("flex"),e=void 0,t={}})}))}})};search();const showAbout=()=>{$(".aboutLink").click(()=>{$(".wrapper, header").toggleClass("blur"),$(".about__container").toggleClass("hidden flex")}),$(".updateBtn").click(()=>{socket.emit("update check")}),socket.on("update progress",e=>{$(".updateBtn").text(e)}),$(".about__container").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))}))};showAbout();