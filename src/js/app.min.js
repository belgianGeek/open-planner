const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".wrapper *").removeClass("translateXbackwards")};$(".confirmation__body__cancel").click(()=>{smartHide(".confirmation","out")});const handleHomeBtnClick=(e,t)=>{$(`.home__${t}__${e}`).click(()=>{var t;"newRequest"===e&&"inRequests"===(t="inRequests")&&$(`.${t}__step1`).removeClass("hidden").addClass("flex"),$(".home").addClass("hidden").removeClass("flex"),$(".returnIcon, .header__container__msg").removeClass("hidden")})},hideMenu=e=>{$("."+e).hasClass("hidden")||$("."+e).removeClass("flex").addClass("hidden")},showMenu=e=>{$("."+e).hasClass("hidden")&&$("."+e).removeClass("hidden").addClass("flex")};handleHomeBtnClick("newRequest","btnContainer");const socket=io();let locales,data2send={table:"",values:[]};$.ajax({url:`/locales/${window.navigator.language.split("-")[0]}.json`,method:"GET",dataType:"json"}).done(e=>{locales=e});const random=e=>e[Math.floor(Math.random()*e.length)];let inRequestsReaderGender,recordDelTimeOut,recordUpdateTimeOut,inRequestsTimeOut;const toggleSwitch=(e,t,a)=>{a?($(e).prop("checked",!0),$(t).removeClass("unchecked").addClass("checked")):($(e).prop("checked",!1),$(t).removeClass("checked").addClass("unchecked"))};let globalSettings={};socket.on("settings",e=>{globalSettings.allowpasswordupdate=e.allowpasswordupdate,globalSettings.instance_name=e.instance_name,globalSettings.instance_description=e.instance_description,globalSettings.sendcc=e.sendcc,globalSettings.sendmail=e.sendmail,globalSettings.sendattachments=e.sendattachments,globalSettings.mail_address=e.mail_address,globalSettings.sender=e.sender,globalSettings.smtp_user=e.smtp_user,globalSettings.smtp_host=e.smtp_host,globalSettings.smtp_passwd=e.smtp_passwd,globalSettings.wallpaper=e.wallpaper,e.sendcc?toggleSwitch(".toggleMailCc__Input",".toggleMailCc__Slider",!0):toggleSwitch(".toggleMailCc__Input",".toggleMailCc__Slider",!1),e.sendmail?toggleSwitch(".toggleMail__Input",".toggleMail__Slider",!0):toggleSwitch(".toggleMail__Input",".toggleMail__Slider",!1),e.sendattachments?toggleSwitch(".toggleAttachments__Input",".toggleAttachments__Slider",!0):toggleSwitch(".toggleAttachments__Input",".toggleAttachments__Slider",!1),e.allowpasswordupdate?toggleSwitch(".toggleUserPasswordUpdate__Input",".toggleUserPasswordUpdate__Slider",!0):toggleSwitch(".toggleUserPasswordUpdate__Input",".toggleUserPasswordUpdate__Slider",!1),$(".settings__child__instanceNameContainer__label__input").val(globalSettings.instance_name),$(".settings__child__descriptionContainer__label__textarea").text(globalSettings.instance_description),$(".settings__child__senderContainer__senderLabel__input").val(globalSettings.sender),$(".settings__child__mailContainer__smtpHostLabel__input").val(globalSettings.smtp_host),$(".settings__child__mailContainer__smtpUserLabel__input").val(globalSettings.smtp_user),$(".settings__child__mailContainer__smtpHostLabel__input").val(globalSettings.smtp_host)}),socket.on("username",e=>{$(".inRequests__form__applicantInfo__name").val(e.name),$(".inRequests__form__applicantInfo__firstname").val(e.firstname)});const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);let validationErr=!1;$(".returnIcon").click(()=>{const e=(e,t)=>{var a;e.match(/(step1|users|locations)/gi)?$(e).is(":visible")&&e.match(/inRequests__step1|users|locations/gi)&&(a=e,$(a).removeClass("translateXbackwards").toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__container__msg").addClass("hidden").removeClass("flex"),setTimeout(()=>{$(a).toggleClass("translateXonwards flex")},500)):$(e).is(":visible")&&($(e).addClass("translateXonwards hidden").removeClass("flex"),$(t).removeClass("translateXbackwards hidden").addClass("flex"))};e(".users"),e(".locations"),e(".inRequests__step1")}),$(".menu__item").click(()=>{$(".header__menu__switch").prop("checked")&&$(".header__menu__switch").prop("checked",!1)});const invalid=e=>{e.addClass("invalid"),validationErr=!0},errorNotification=(e,t)=>{t?$(".import__child__container__notification").addClass("notificationFailure").html(`\n        ${locales.import.error} :\n        <br>\n        ${e}\n        `):($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationSuccess").addClass("notificationFailure"),$(".notification__msg").text(locales.notification.failure+"... 😱"))},successNotification=(e,t)=>{var s;e?0===t?($(".import__child__container__notification").addClass("notificationFailure"),errorNotification(""+locales.import.error_notification,e)):($(".import__child__container__notification").addClass("notificationSuccess"),1===t?$(".import__child__container__notification").text(`${t} ${locales.import.success_single}`):$(".import__child__container__notification").text(`${t} ${locales.import.success_multiple}`)):($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationFailure").addClass("notificationSuccess"),$(".notification__msg").text((a=locales.notification.success)[Math.floor(Math.random()*a.length)]+" ! 😉"))};socket.on("notification",e=>{var t,a,s;e.isImport&&$(".import__child__container__notification").removeClass("hidden").addClass("flex"),"success"===e.type?(t=e.isImport,a=e.usersNb,t?0===a?($(".import__child__container__notification").addClass("notificationFailure"),errorNotification(""+locales.import.error_notification,t)):($(".import__child__container__notification").addClass("notificationSuccess"),1===a?$(".import__child__container__notification").text(`${a} ${locales.import.success_single}`):$(".import__child__container__notification").text(`${a} ${locales.import.success_multiple}`)):($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationFailure").addClass("notificationSuccess"),$(".notification__msg").text((s=locales.notification.success)[Math.floor(Math.random()*s.length)]+" ! 😉"))):"error"===e.type?errorNotification(e.error,e.isImport):"info"===e.type?($(".notification__icon").attr("src","./src/scss/icons/info.svg"),$(".notification").removeClass("notificationSuccess notificationMail notificationFailure").addClass("notificationInfo"),$(".notification__msg").text(locales.notification.notFound)):"mail"===e.type&&($(".notification__icon").attr("src","./src/scss/icons/mail.svg"),$(".notification").removeClass("notificationInfo notificationSuccess notificationFailure").addClass("notificationMail"),$(".notification__msg").text("Mail envoyé 😎")),e.isImport?setTimeout(()=>{$(".import__child__container__notification").removeClass("notificationFailure notificationSuccess flex").addClass("hidden")},1e4):($(".notification").removeClass("hidden").addClass("flex"),setTimeout(()=>{$(".notification").fadeOut((function(){$(this).removeAttr("style").removeClass("notificationSuccess notificationFailure notificationInfo flex").addClass("hidden")}))},5e3))});const smartHide=(e,t,a)=>{"in"===t?($(e).toggleClass("hidden flex"),$(".wrapper, .header").addClass("blur")):($(e).toggleClass("hidden flex"),$(".wrapper, .header").removeClass("blur"),void 0!==a&&clearTimeout(a))},clearRegisterTitleClasses=()=>$(".register__title").removeClass("myAccountTitle updateUserTitle addUserTitle"),clearAddLocationTitleClasses=()=>$(".addLocation__title").removeClass("updateLocationTitle newLocationTitle"),clearAllFormsTitleClasses=()=>{clearRegisterTitleClasses(),clearAddLocationTitleClasses()},compress=(e,t,a)=>{const s=document.querySelector(e).files[0];if(!s)return console.error("Compression failed because there is no file !");{const e=new FileReader;e.readAsDataURL(s),e.onload=e=>{const s=document.createElement("img");s.src=e.target.result,s.onload=e=>{const s=window.innerWidth,n=document.createElement("canvas");n.height=e.target.height*(s/e.target.width),n.width=s;const i=n.getContext("2d");i.drawImage(e.target,0,0,n.width,n.height);const _=i.canvas.toDataURL(t,.8);a(_)}}}},setDate=()=>{$(".inRequests__form__requestInfo__row1__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`)},setDay=e=>e.getDate()<10?"0"+e.getDate():e.getDate(),setMonth=e=>e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1;$(".inRequests__form__requestInfo__row1__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`);const dbConfig=()=>{let e=$(".dbConfig__form__name input"),t=$(".dbConfig__form__description textarea"),a=$(".dbConfig__form__locationName input"),s=$(".dbConfig__form__locationMail input"),n=$(".dbConfig__form__senderLabel input"),i=$(".dbConfig__form__smtpUserLabel input"),_=$(".dbConfig__form__smtpHostLabel input"),o=$(".dbConfig__form__smtpPasswdLabel input");$(".dbConfig__form").submit(r=>{r.preventDefault(),socket.emit("append settings",{instance:e.val(),instance_description:t.val(),location_name:a.val(),location_mail:s.val(),sender:n.val(),smtp_user:i.val(),smtp_host:_.val(),smtp_passwd:o.val()})}),socket.on("settings import",t=>{t&&($(".home__mainTitle").text(`${e.val()} - ${locales.config.first_admin}`),hideMenu("dbConfig"),showMenu("register"))}),"/login"===window.location.pathname&&(socket.emit("get locations"),socket.on("locations retrieved",e=>{if(null!==e){$(".register__form__location select option").each((function(){""===$(this).val()&&$(this).remove()}));const t=$("<option>").val(e.location_id).text(e.location_name);$(".register__form__location select").append(t)}}),socket.on("first user added",()=>{window.location.reload()}))};dbConfig();const exportDB=()=>{let e="";$(".export__child__container__format input.radio").each((function(){$(this).is(":checked")&&(e=$(this).val())})),socket.emit("export db",e),e=""};let initialPibNb,initialBarcode;$(".exportsLink").click(()=>{smartHide(".export","in"),format=""}),$(".export .btn--submit").click(()=>{exportDB()}),$(".export .btn--reset").click(()=>{smartHide(".export","out")}),socket.on("export successfull",()=>{smartHide(".export","out"),window.open("/download")}),$(".importLink").click(()=>{smartHide(".import","in"),format=""}),$(".import .btn--reset").click(()=>{smartHide(".import","out")}),$(".import__child__container__file").submit(e=>{e.preventDefault();const t=$(".import__child__container__file__upload__input");let a=new FormData;a.append("dataUpload",t[0].files[0],"users.csv"),$.ajax({method:"POST",url:"/upload",processData:!1,contentType:!1,data:a}).fail(()=>{errorNotification()}).always(()=>{t.val(""),a=new FormData})});const inRequests=()=>{let e,t,a=$(".inRequests__form__applicantInfo__name"),s=$(".inRequests__form__applicantInfo__firstname"),n=$(".inRequests__form__requestInfo__row1__requestDate"),i=$(".inRequests__form__requestInfo__comment");data2send.sendattachment=!1;const _=()=>{$(".inRequests").hasClass("absolute")?$(".inRequests").toggleClass("blur"):$(".wrapper, .inRequests").toggleClass("blur")};$(".inRequests__form__requestInfo__row1__file").on("change",(function(){""!==$("."+$(this).attr("class").split(" ").join(".")).val()?compress("."+$(this).attr("class").split(" ").join("."),"image/jpeg",e=>{$(".inRequests img").attr("src",e),t=e,data2send.sendattachment=!0}):(t=void 0,data2send.sendattachment=!1)})),$(".inRequests__form__btnContainer__submit").click(o=>{o.preventDefault();let r=$(".inRequests__form__applicantInfo__location option:selected"),l=$(".inRequests__form__requestInfo__row1__assignedWorker option:selected");data2send.table="tasks",""===a.val()&&invalid(a),""===s.val()&&invalid(s),$(".inRequests").hasClass("absolute")||""===r.val()&&invalid(r),""===n.val()&&invalid(n),""===i.val()&&invalid(i),$(".inRequests").hasClass("absolute")&&"default"===l.val()&&invalid($(".inRequests.absolute .inRequests__form__requestInfo__row1__assignedWorker"));const c=()=>{data2send.sendattachment&&globalSettings.sendattachments?(data2send.values.push(data2send.sendattachment),data2send.values.push(t)):data2send.values.push(data2send.sendattachment)};if(validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text(locales.form.invalid).appendTo(".inRequests__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),_(),e=setTimeout(()=>{if(a.val(a.val().replace(/'/g,"''")),s.val(s.val().replace(/'/g,"''")),i.val(i.val().replace(/'/g,"''")),data2send.values.push(a.val()),data2send.values.push(s.val()),data2send.values.push(i.val()),data2send.mail={},"/src/scss/icons/empty.svg"!==$(".inRequests img").attr("src")&&(data2send.sendattachment=!0),$(".inRequests").hasClass("absolute")?(data2send.mail.id=data2send.id=$(".inRequests.absolute .inRequests__id").text(),data2send.mail.creationDate=new Date(n.val()).toLocaleDateString(),"done"===$(".inRequests__form__requestInfo__row1__status option:selected").val()?(data2send.mail.title=`🏁 La demande n°${data2send.mail.id} est traitée 🏁`,data2send.mail.status="done"):(data2send.mail.title=`🙃 La demande n°${data2send.mail.id} a été mise à jour 🙃`,data2send.mail.status="wip"),data2send.values.push($(".inRequests__form__requestInfo__row1__status option:selected").val()),data2send.values.push(l.val()),c(),$(".inRequests.absolute").toggleClass("hidden flex"),$(".wrapper").removeClass("blur"),socket.emit("update",data2send),$(".inRequests.absolute .inRequests__form__btnContainer__hide").toggleClass("hidden")):(data2send.values.push(new Date(n.val()).toUTCString()),data2send.values.push(r.val()),data2send.mail.title=`🔥 ${globalSettings.instance_name} - Une nouvelle demande a été enregistrée 🔥`,data2send.mail.status="waiting",data2send.values.push("waiting"),c(),socket.emit("append data",data2send),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")),globalSettings.sendmail){let e={request:i.val(),applicant:{name:a.val(),firstname:s.val(),location:r.text()},sendcc:globalSettings.sendcc,mail:data2send.mail};data2send.sendattachment&&globalSettings.sendattachments&&(e.attachments=[{filename:`${globalSettings.instance_name.replace(/[\/'\s]/,"-")}_${Date.now()}.jpg`,encoding:"base64",content:$(".inRequests img").attr("src").split(";base64,").pop()}]),socket.emit("send mail",e)}$(".inRequests__form__requestInfo__comment, .inRequests__form__requestInfo__row1__file").val(""),$(".inRequests__form__applicantInfo__location option:selected").val("default"),confirmation(),$(".inRequests img").removeClass("hidden"),data2send.values=[],_()},5e3)}),$(".inRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e),$(".inRequests").hasClass("absolute")?$(".inRequests").removeClass("blur"):$(".wrapper, .inRequests").removeClass("blur")})};let addLocationTimeout;inRequests();const manageLocations=()=>{$(".addLocation__form__btnContainer__submit").click(()=>{event.preventDefault(),data2send.table="locations";let e=$(".addLocation__form__name input"),t=$(".addLocation__form__email input");if(""===e.val()&&invalid(e),(t.is(":invalid")||""===t.val())&&invalid(t),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text(locales.form.invalid).appendTo(".addLocation__form")}validationErr=!1,data2send.values=[]}else{const a=()=>{data2send.values.push(capitalizeFirstLetter(e.val())),data2send.values.push(t.val()),$(".addLocation__title").hasClass("newLocationTitle")?socket.emit("append data",data2send):(data2send.id=$(".addLocation.absolute .addLocation__form__userID").val(),socket.emit("update",data2send)),data2send.values=[],$(".addLocation").toggleClass("hidden flex").removeClass("blur"),$(".addLocation input").val(""),confirmation(),$(".locations, .header").removeClass("blur backgroundColor"),clearAddLocationTitleClasses()};$(".input").removeClass("invalid"),$("form .warning").addClass("hidden"),confirmation(),$(".addLocation").addClass("blur"),addLocationTimeout=setTimeout((function(){a()}),5e3)}}),$(".addLocation__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(addLocationTimeout),$(".addLocation").removeClass("blur")})};$(".addLocation__form__btnContainer__submit").click(()=>{event.preventDefault(),data2send.table="locations";let e=$(".addLocation__form__name input"),t=$(".addLocation__form__email input");if(""===e.val()&&invalid(e),(t.is(":invalid")||""===t.val())&&invalid(t),validationErr)$("form .warning").length||$("<span></span>").addClass("warning").text(locales.form.invalid).appendTo(".addLocation__form"),validationErr=!1,data2send.values=[];else{const a=()=>{data2send.values.push(capitalizeFirstLetter(e.val())),data2send.values.push(t.val()),$(".addLocation__title").hasClass("newLocationTitle")?socket.emit("append data",data2send):(data2send.id=$(".addLocation.absolute .addLocation__form__userID").val(),socket.emit("update",data2send)),data2send.values=[],$(".addLocation").toggleClass("hidden flex").removeClass("blur"),$(".addLocation input").val(""),confirmation(),$(".locations, .header").removeClass("blur backgroundColor"),clearAddLocationTitleClasses()};$(".input").removeClass("invalid"),$("form .warning").addClass("hidden"),confirmation(),$(".addLocation").addClass("blur"),addLocationTimeout=setTimeout((function(){a()}),5e3)}}),$(".addLocation__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(addLocationTimeout),$(".addLocation").removeClass("blur")});let parent,iDataRow=0;function userTypeSwitch(e){let t="";switch(e){case"guest":t=locales.account_type.guest;break;case"user":t=locales.account_type.user;break;case"admin":t=locales.account_type.admin}return t}const appendUserRow=(e,t)=>{let a=$("<span></span>").addClass(`users__container__row users__container__row--${e} flex`).appendTo(".users__container"),s=($("<span></span>").addClass("users__container__row__item users__container__row__item--id hidden").append(t.user_id).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--name").append(t.name.replace(/\'\'/g,"'")).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--firstname").append(t.firstname.replace(/\'\'/g,"'")).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--email").append(t.email).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--location").appendTo(a));null!==t.location_name?s.append(t.location_name):s.append("Aucune");$("<span></span>").addClass("users__container__row__item users__container__row__item--location_id hidden").append(t.location_id).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--gender hidden").append(t.gender).appendTo(a),$("<input>").attr("type","password").addClass("users__container__row__item users__container__row__item--pwd input noInput").val("12345678").appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--type").append(userTypeSwitch(t.type)).appendTo(a),$("<span></span>").addClass("users__container__row__item users__container__row__item--hiddenType hidden").append(t.type).appendTo(a)},appendLocationRow=(e,t)=>{let a=$("<span></span>").addClass(`locations__container__row locations__container__row--${e} flex`).appendTo(".locations__container");$("<span></span>").addClass("locations__container__row__item locations__container__row__item--id hidden").append(t.location_id).appendTo(a),$("<span></span>").addClass("locations__container__row__item locations__container__row__item--name").append(t.location_name.replace(/\'\'/g,"'")).appendTo(a),$("<span></span>").addClass("locations__container__row__item locations__container__row__item--email").append(t.location_mail).appendTo(a)},manageUsers=()=>{const e=(e,t)=>{$(`.${e}.absolute .${e}__form__btnContainer__hide`).ready((function(){$(`.${e}.absolute .${e}__form__btnContainer__hide`).click((function(){$("."+e).removeClass("absolute zero flex").addClass("hidden"),$(`.${t}, .header`).removeClass("blur backgroundColor"),$(this).addClass("hidden")}))}))},t=(e,t)=>{$(`.${t}__header__addBtn`).click((function(){$(`.${t}, .header`).addClass("blur backgroundColor"),$(`.${e} input`).not(".radio").val(""),$(".register select").val("default"),"users"===t?($(".register__title").text(locales.users.add_title),$(".register__title").addClass("addUserTitle")):($(".addLocation__title").text(locales.locations.add_title),$(".addLocation__title").addClass("newLocationTitle")),$("."+e).addClass("absolute zero flex").removeClass("hidden")})),$(`.${e}.absolute .${e}__form__btnContainer__submit`).click((function(){$("."+e).removeClass("absolute zero flex").addClass("hidden")}))},a=(e,t,a)=>{if($(`.${a}__container`).empty((function(){$(this).fadeOut()})),void 0!==e[0]){let s=$("<span></span>").addClass(a+"__container__header flex").appendTo(`.${a}__container`);for(const[t,n]of Object.keys(e[0]).entries()){let e=n;if("users"===a)switch(n){case"name":e=locales.form.name_generic;break;case"firstname":e=locales.form.firstname_generic;break;case"email":e=locales.form.mail_generic;break;case"location":e=locales.form.location_generic;break;case"password":e=locales.login.passwd;break;case"type":e=locales.register.account_type;break;default:e=""}else switch(n){case"location_name":e=locales.form.name_generic;break;case"location_mail":e=locales.form.mail_generic;break;default:e=""}if(""!==e){$("<span></span>").addClass(a+"__container__header__item").text(e).appendTo(s)}}for(const[t,s]of e.entries())"users"===a?appendUserRow(t,s):appendLocationRow(t,s),t===e.length-1&&(iDataRow=t+1);$(`.${a}__container`).fadeIn(),$(".context").length&&($(`.${a}__container__row`).contextmenu((function(e){$(".context").css({left:e.pageX+"px",top:e.pageY+"px"}).toggleClass("hidden flex"),parent=$(this).attr("class").split(" ")[1],e.preventDefault(),$(`.${a}, .${a} *`).click((function(e){e.target===this&&$(".context").removeClass("flex").addClass("hidden")}))})),$(".context__list__item--modify").click((function(){let e,s;$(".users").hasClass("flex")?($(".register").addClass("absolute zero flex").removeClass("hidden"),$(".register.absolute .register__form__password input").attr("placeholder",locales.form.passwd_empty),$(".users, .header").addClass("blur backgroundColor")):$(".locations").hasClass("flex")&&($(".addLocation").addClass("absolute zero flex").removeClass("hidden"),$(".locations, .header").addClass("blur backgroundColor")),"users"===a?(e=locales.users.modify_title,s="updateUserTitle"):(e=locales.locations.modify_title,s="updateLocationTitle"),$(`.${t}__title`).text(`${e} ${$(`.${parent} .${a}__container__row__item--firstname`).text()}\n            ${$(`.${parent} .${a}__container__row__item--name`).text()}`).addClass(s),$(`.${t}.absolute .${t}__form__userID`).val($(`.${parent} .${a}__container__row__item--id`).text()),$(`.${t}.absolute .${t}__form__name input`).val($(`.${parent} .${a}__container__row__item--name`).text()),$(`.${t}.absolute .${t}__form__email input`).val($(`.${parent} .${a}__container__row__item--email`).text()),"users"===a&&($(`.${t}.absolute .${t}__form__userFirstName input`).val($(`.${parent} .${a}__container__row__item--firstname`).text()),$(`.${t}.absolute .${t}__form__location select`).val($(`.${parent} .${a}__container__row__item--location_id`).text()),$(`.${t}.absolute .${t}__form__type select`).val($(`.${parent} .${a}__container__row__item--hiddenType`).text()),"m"===$(`.${parent} .${a}__container__row__item--gender`).text()?$(`.${t}.absolute .${t}__form__male input`).attr("checked",!0):$(`.${t}.absolute .${t}__form__female input`).attr("checked",!0)),$(`.${t}.absolute .${t}__form__btnContainer__submit`).click(()=>{$(`.${parent} .${a}__container__row__item--name`).text($(`.${t}__form__name input`).val().replace(/\'\'/g,"'")),$(`.${parent} .${a}__container__row__item--email`).text($(`.${t}__form__email input`).val()),"users"===a&&($(".register.absolute .register__form__password input").attr("placeholder",locales.form.passwd_generic),$(`.${parent} .${a}__container__row__item--firstname`).text($(`.${t}__form__userFirstName input`).val().replace(/\'\'/g,"'")),$(`.${parent} .${a}__container__row__item--location`).text($(`.${t}__form__location option:selected`).text().replace(/\'\'/g,"'")),$(`.${parent} .${a}__container__row__item--hiddenType`).text($(`.${t}__form__type option:selected`).val()),$(`.${parent} .${a}__container__row__item--type`).text(userTypeSwitch($(`.${t}__form__type option:selected`).val())))})})),$(".context__list__item--del").click((function(){let e={};parent.match("users")?(e.key=$(`.${parent} .users__container__row__item--id`).text(),e.table="users"):parent.match("locations")&&(e.key=$(`.${parent} .locations__container__row__item--id`).text(),e.table="locations"),confirmation(),recordDelTimeOut=setTimeout(()=>{$("."+parent).removeClass("flex").addClass("hidden"),confirmation(),socket.emit("delete data",e),e={}},5e3)})))}},s=(e,t)=>{$(`.${e}Link`).click(()=>{hideMenu("inRequests"),hideMenu(t),showMenu(e),socket.emit("get "+e)})};s("users","locations"),s("locations","users"),$(".locationsLink, .usersLink").click((function(){($(".locations").hasClass("hidden")||$(".users").hasClass("hidden"))&&$(".home").removeClass("flex").addClass("hidden"),showMenu("returnIcon"),showMenu("header__container__msg")})),socket.on("users retrieved",e=>{a(e,"register","users")}),socket.on("locations retrieved",e=>{"/"===window.location.pathname&&a(e,"addLocation","locations")}),$(".context__list__item").click(()=>{$(".context").removeClass("flex").addClass("hidden")}),$(".context__list__item--modify, .locations__header__addBtn, .users__header__addBtn").click(()=>{e("register","users"),e("addLocation","locations")}),$(".confirmation__body__cancel").click(()=>{clearTimeout(recordDelTimeOut),$("."+parent).removeClass("hidden").addClass("flex"),recordDelTimeOut=void 0,record2delete={}}),t("register","users"),t("addLocation","locations")};manageUsers();const register=()=>{let e,t=$(".register__form__name input"),a=$(".register__form__userFirstName input"),s=$(".register__form__password input"),n=$(".register__form__email input");$(".register__form__btnContainer__submit").click(i=>{i.preventDefault(),data2send.table="users",data2send.setType=!1;let _,o="",r=$(".register__form__location option:selected").val();if($(".register__form__type").length&&(_=$(".register__form__type option:selected").val()),$(".register__form__gender input.radio").each((function(){$(this).is(":checked")&&(o=$(this).val())})),""===t.val()&&invalid(t),""===a.val()&&invalid(a),"default"===r&&invalid($(".register__form__location .input")),$(".register").hasClass("absolute")&&!$(".register__title").hasClass("addUserTitle")&&$(".register__title").length||""===s.val()&&invalid(s),(n.is(":invalid")||""===n.val())&&invalid(n),$(".register__form__type").length&&(data2send.setType=!0,"default"===_&&invalid($(".register__form__type .input"))),""===o&&invalid($(".register__form__gender input.radio")),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text(locales.form.invalid).appendTo(".register__form")}validationErr=!1,data2send.values=[]}else{const i=()=>{data2send.values=[capitalizeFirstLetter(t.val()),capitalizeFirstLetter(a.val()),n.val(),r,o],$(".register__form__type").length&&data2send.values.push(_),data2send.setPassword=!0,$(".register__title").hasClass("addUserTitle")||!$(".register__title").length?(data2send.values.push(s.val()),socket.emit("append data",data2send)):(data2send.id=$(".register.absolute .register__form__userID").val(),""!==s.val()?(data2send.setPassword=!0,data2send.values.push(s.val())):data2send.setPassword=!1,socket.emit("update",data2send),s.attr("placeholder",locales.form.passwd_generic)),$(".register").toggleClass("blur"),$(".register__title").hasClass("myAccountTitle")||$(".register input").not(".radio").val(""),$(".register").toggleClass("hidden flex"),"/"===window.location.pathname&&(confirmation(),$(".register").length&&$(".register__title").hasClass("myAccountTitle")&&$(".greetings").text(`${locales.greetings} ${$(".register__form__userFirstName input").val()} ${$(".register__form__name input").val()} !`),data2send.values=[],clearRegisterTitleClasses())};$(".input").removeClass("invalid"),$("form .warning").addClass("hidden"),"/"===window.location.pathname?(confirmation(),$(".register").toggleClass("blur"),e=setTimeout((function(){i(),$(".users, .wrapper, .header").removeClass("blur backgroundColor")}),5e3)):i()}}),$(".register__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e),$(".register").hasClass("absolute")&&($(".register__title").hasClass("myAccountTitle")&&$(".wrapper, .header").addClass("blur"),$(".register").removeClass("blur"))})};register();const search=()=>{let e={table:"tasks",applicant_name:"",getApplicant:!1};const t=()=>$(".wrapper").toggleClass("blur");$(".search__container").submit(t=>{t.preventDefault(),e.getApplicant=!1,"default"!==$(".search__container__select").val()&&(e.location=$(".search__container__select").val()),""!==$(".search__container__readerInput").val()&&(e.applicant_name=$(".search__container__readerInput").val().replace(/\'/g,"''"),e.getApplicant=!0),socket.emit("search",e),e.location=void 0,e.applicant_name="",e.getApplicant=!1}),socket.on("search results",e=>{let a;if($(".search__results__container").empty((function(){$(this).fadeOut()})),void 0!==e[0]){let s=$("<span></span>").addClass("search__results__container__header flex").appendTo(".search__results__container");for(const[t,a]of Object.keys(e[0]).entries()){let e=a;switch(a){case"attachment":e=globalSettings.sendattachments?locales.search.attachment:"";break;case"task_id":e=locales.search.request_number;break;case"location_name":case"location_name":case"location_name":e="Implantation";break;case"applicant_name":e=locales.request.applicant_name;break;case"applicant_firstname":e=locales.request.applicant_firstname;break;case"request_date":e="Date";break;case"comment":e=locales.search.request_content;break;case"status":e=locales.search.status;break;case"user_fk":e=locales.search.assignment;break;default:e=""}if(""!==e){$("<span></span>").addClass("search__results__container__header__item").text(e).appendTo(s)}}for(const[t,a]of e.entries()){let e=$("<span></span>").addClass(`search__results__container__row search__results__container__row--${t} flex`).appendTo(".search__results__container"),s=($("<span></span>").addClass("search__results__container__row__item  rowItem search__results__container__row__item--id").append(a.task_id).appendTo(e),$("<span></span>").addClass("search__results__container__row__item  rowItem search__results__container__row__item--name").append(a.applicant_name.replace(/\'\'/g,"'")).appendTo(e),$("<span></span>").addClass("search__results__container__row__item  rowItem search__results__container__row__item--firstname").append(a.applicant_firstname.replace(/\'\'/g,"'")).appendTo(e),$("<span></span>").addClass("search__results__container__row__item  rowItem search__results__container__row__item--date")),n=$("<span></span>").addClass("search__results__container__row__item  rowItem search__results__container__row__item--timestamp hidden");null!==a.request_date?(s.append(new Date(a.request_date).toLocaleDateString()),n.append(a.request_date.split("T")[0])):s.append(locales.search.display_error),n.appendTo(e),s.appendTo(e);let i=$("<span></span>").addClass("search__results__container__row__item  rowItem search__results__container__row__item--aw").appendTo(e),_={"''":"'","\n":"<br>"};$("<span></span>").addClass("search__results__container__row__item  rowItem search__results__container__row__item--body").append(a.comment.replace(/\n|\'\'/g,e=>_[e])).appendTo(e);if(void 0!==a.user_fk&&null!==a.user_fk){i.append(`${a.name.toUpperCase()}, ${a.firstname}`);$("<span></span>").addClass("search__results__container__row__item--awid hidden").append(a.user_fk).appendTo(e)}else null===a.user_fk?i.append(locales.request.status_waiting):(i.append(locales.search.display_error),console.trace(`Assigned worker for task n°${a.task_id} : ${a.name.toUpperCase()}, ${a.firstname}`));let o=$('      <svg xmlns="http://www.w3.org/2000/svg">        <circle cx="50%" cy="50%" r="5"/>        <title class="status__title"></title>      </svg>      ').addClass("search__results__container__row__item  search__results__container__row__item--status").attr("viewBox","0 0 75 10").appendTo(e);if("waiting"===a.status?(o.removeClass("done wip").addClass("waiting"),$(`.${o.attr("class").split(" ").join(".")} .status__title`).text(locales.search.status_title.waiting)):"done"===a.status?(o.removeClass("waiting wip").addClass("done"),$(`.${o.attr("class").split(" ").join(".")} .status__title`).text(locales.search.status_title.done)):(o.removeClass("done waiting").addClass("wip"),$(`.${o.attr("class").split(" ").join(".")} .status__title`).text(locales.search.status_title.wip)),globalSettings.sendattachments){let t=$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--file");if(a.attachment){t.append("📎");$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--fileSrc hidden").append(a.attachment_src).appendTo(e)}t.appendTo(e)}if("default"===$(".search__container__select").val()){let t=$("<span></span>").addClass("search__results__container__row__item  rowItem search__results__container__row__item--location");null!==a.location_name?t.append(a.location_name):t.append("Problème d'affichage..."),t.appendTo(e)}}$(".search__results__container").fadeIn(),$(".context").length&&($(".search__results__container__row").contextmenu((function(e){$(".context").css({left:e.pageX+"px",top:e.pageY+"px"}).toggleClass("hidden flex"),a=$(this).attr("class").split(" ")[1],e.preventDefault(),$(".search__results, .search__results *").click((function(e){e.target===this&&$(".context").removeClass("flex").addClass("hidden")}))})),$(".context__list__item").click(()=>{$(".context").removeClass("flex").addClass("hidden")}),$(".context__list__item--modify").click((function(){let e=$(`.${a} .search__results__container__row__item--timestamp`).text();$(".wrapper").addClass("blur"),$(".inRequests").addClass("absolute flex").removeClass("hidden"),$(".inRequests.absolute .inRequests__form__applicantInfo__name, .inRequests.absolute .inRequests__form__applicantInfo__firstname, .inRequests.absolute .inRequests__form__requestInfo__row1__requestDate").attr("disabled",!0),$(`.${a} .search__results__container__row__item--fileSrc`).length?$(".inRequests img").attr("src",$(`.${a} .search__results__container__row__item--fileSrc`).text()):$(".inRequests img").addClass("hidden"),$(".inRequests.absolute .inRequests__id").text($(`.${a} .search__results__container__row__item--id`).text()),$(".inRequests.absolute .inRequests__form__applicantInfo__location").val($(".search__container__select").val()),$(".inRequests.absolute .inRequests__form__applicantInfo__name").val($(`.${a} .search__results__container__row__item--name`).text()),$(".inRequests.absolute .inRequests__form__applicantInfo__firstname").val($(`.${a} .search__results__container__row__item--firstname`).text()),$(".inRequests.absolute .inRequests__form__requestInfo__row1__requestDate").val(e),$(".inRequests.absolute .inRequests__form__requestInfo__comment").val($(`.${a} .search__results__container__row__item--body`).html().replace(/<br>/g,"\n\n")),$(a+" .search__results__container__row__item--awid").length&&$(".inRequests.absolute .inRequests__form__requestInfo__row1__assignedWorker option:selected").val($(`.${a} .search__results__container__row__item--awid`).text()),$(`.${a} .search__results__container__row__item--status`).hasClass("wip")?$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("wip"):$(`.${a} .search__results__container__row__item--status`).hasClass("waiting")?$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("waiting"):$(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val("done"),$(".inRequests.absolute .inRequests__form__btnContainer__submit").click(()=>{$(`.${a} .search__results__container__row__item--name`).text($(".inRequests__form__applicantInfo__name").val().replace(/\'\'/g,"'")),$(`.${a} .search__results__container__row__item--firstname`).text($(".inRequests__form__applicantInfo__firstname").val().replace(/\'\'/g,"'")),$(`.${a} .search__results__container__row__item--date`).text(new Date($(".inRequests__form__requestInfo__row1__requestDate").val()).toLocaleDateString()),$(`.${a} .search__results__container__row__item--location`).text($(".inRequests__form__applicantInfo__location option:selected").text().replace(/\'\'/g,"'")),$(`.${a} .search__results__container__row__item--body`).html($(".inRequests__form__requestInfo__comment").val().replace(/\n\n/g,"<br>")),"default"!==$(".inRequests__form__requestInfo__row1__assignedWorker option:selected").val()?$(`.${a} .search__results__container__row__item--aw`).text($(".inRequests__form__requestInfo__row1__assignedWorker option:selected").text().replace(/\'\'/g,"'")):$(`.${a} .search__results__container__row__item--aw`).text(locales.request.status_waiting),$(`.${a} .search__results__container__row__item--status`).removeClass("waiting wip done").addClass($(".inRequests.absolute .inRequests__form__requestInfo__row1__status").val())}),$(".inRequests.absolute .inRequests__form__btnContainer__hide").click((function(){$(".inRequests").removeClass("absolute flex").addClass("hidden"),$(".wrapper").removeClass("blur backgroundColor"),$(this).addClass("hidden"),$(".inRequests img").removeClass("hidden")}))})),$(".context__list__item--del").click((function(){let e={key:$(`.${a} .search__results__container__row__item--id`).text(),table:"tasks"};confirmation(),t(),$("."+a).toggleClass("hidden flex"),recordDelTimeOut=setTimeout(()=>{$("."+a).remove(),confirmation(),socket.emit("delete data",e),e={},t()},5e3),$(".confirmation__body__cancel").click(()=>{clearTimeout(recordDelTimeOut),$("."+a).removeClass("hidden").addClass("flex"),recordDelTimeOut=void 0,e={}})})))}})};search();const settings=()=>{$(".settingsLink").click(()=>{$(".settings__container").toggleClass("hidden flex"),$(".wrapper").addClass("blur")}),$(".settings__container").click((function(e){if(e.target===this){let e={};$(this).toggleClass("hidden flex"),$(".wrapper").removeClass("blur"),globalSettings.instance_name!==$(".settings__child__instanceNameContainer__label__input").val()&&(e.instance_name=globalSettings.instance_name=$(".settings__child__instanceNameContainer__label__input").val().replace(/\'\'/g,"'")),globalSettings.instance_description!==$(".settings__child__descriptionContainer__label__textarea").val()&&(e.instance_description=globalSettings.instance_description=$(".settings__child__descriptionContainer__label__textarea").val().replace(/\'\'/g,"'")),globalSettings.sendmail!==$(".toggleMail__Input").prop("checked")&&(e.sendmail=globalSettings.sendmail=$(".toggleMail__Input").prop("checked")),globalSettings.sendcc!==$(".toggleMailCc__Input").prop("checked")&&(e.sendcc=globalSettings.sendcc=$(".toggleMailCc__Input").prop("checked")),globalSettings.sendattachments!==$(".toggleAttachments__Input").prop("checked")&&(e.sendattachments=globalSettings.sendattachments=$(".toggleAttachments__Input").prop("checked")),globalSettings.sender!==$(".settings__child__senderContainer__senderLabel__input").val()&&(e.sender=globalSettings.sender=$(".settings__child__senderContainer__senderLabel__input").val()),globalSettings.smtp_host!==$(".settings__child__mailContainer__smtpHostLabel__input").val()&&(e.smtp_host=globalSettings.smtp_host=$(".settings__child__mailContainer__smtpHostLabel__input").val()),globalSettings.smtp_user!==$(".settings__child__mailContainer__smtpUserLabel__input").val()&&(e.smtp_user=globalSettings.smtp_user=$(".settings__child__mailContainer__smtpUserLabel__input").val()),""!==$(".settings__child__mailContainer__smtpPasswdLabel__input").val()&&(e.smtp_passwd=$(".settings__child__mailContainer__smtpPasswdLabel__input").val()),globalSettings.allowpasswordupdate!==$(".toggleUserPasswordUpdate__Input").prop("checked")&&(e.allowpasswordupdate=globalSettings.allowpasswordupdate=$(".toggleUserPasswordUpdate__Input").prop("checked")),Object.keys(e).length>0&&socket.emit("settings",e)}}))};settings();const showAbout=()=>{$(".aboutLink").click(()=>{$(".wrapper, header").toggleClass("blur"),$(".about__container").toggleClass("hidden flex")}),$(".updateBtn").click(()=>{socket.emit("update check")}),socket.on("update progress",e=>{$(".updateBtn").text(e)}),$(".about__container").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))}))};showAbout(),$(".accountLink").click(()=>{$(".register__title").text(locales.sidebar.account).addClass("myAccountTitle"),$(".wrapper, .header").addClass("blur"),$(".register").addClass("absolute flex").removeClass("hidden"),$(".register.absolute .register__form__btnContainer__hide").click((function(){$(".register.absolute").removeClass("absolute zero flex").addClass("hidden"),$(".wrapper, .header").removeClass("blur"),$(this).addClass("hidden")}))});